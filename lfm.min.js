window.LFM=window.LFM||function(){var g=null,i=null,f=null,j=null,l=function(a,b,c,d){a={api_key:g,method:a};a=m(a,c);if(f)a.sk=f.key;a.api_sig=n(a);a=k(a);c="http://ws.audioscrobbler.com/2.0/?format=json";b=(b||"GET").toUpperCase();b==="GET"&&(c+="&"+a);var e=new XMLHttpRequest;e.open(b,c,true);b==="POST"&&(e.setRequestHeader("Content-type","application/x-www-form-urlencoded"),e.setRequestHeader("Content-length",a.length),e.setRequestHeader("Connection","close"));e.onreadystatechange=function(){e.readyState==
4&&e.status==200&&d(JSON.parse(e.responseText))};e.send(b==="POST"?a:null)},n=function(a){var b=[],c="",d;for(d in a)b.push(d);b.sort();for(var e in b)d=b[e],c+=d+a[d];c+=i;return LFM.md5(c)},h={get:function(a){return JSON.parse(localStorage.getItem(a))},set:function(a,b){localStorage.setItem(a,JSON.stringify(b))},del:function(a){localStorage.removeItem(a)}},k=function(a){var b=[],c;for(c in a)a.hasOwnProperty(c)&&b.push(c+"="+escape(a[c]));return b.join("&")},o=function(a){var a=(a.search+a.hash).split(/[&?#]/),
b={},c;for(c in a){var d=a[c].split("=");d[0]&&(b[d[0]]=unescape(d[1]))}return b},m=function(a,b){var c={},d;for(d in a)c[d]=a[d];for(var e in b)c[e]=b[e];return c};return{init:function(a){g=a.key;i=a.secret||null;f=h.get("session")},getSession:function(){return f},login:function(a){j=a;a="http://www.last.fm/api/auth?"+k({api_key:g,cb:"http://localhost/html5-radio/callback.html"});window.open(a,"lastfmLogin","height=600,width=980")},logout:function(a){h.del("session");a()},loginCallback:function(){var a=
window.open("","lastfmLogin"),b=o(a.location);a.close();b.token&&l("auth.getSession","post",{token:b.token},function(a){h.set("session",a.session)});j()},api:l}}();
